<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
<HEAD>
	<META HTTP-EQUIV="CONTENT-TYPE" CONTENT="text/html; charset=utf-8">
	<TITLE>The VO Frontend</TITLE>
	<META NAME="GENERATOR" CONTENT="OpenOffice.org 2.4  (Linux)">
	<META NAME="CREATED" CONTENT="0;0">
	<META NAME="CHANGEDBY" CONTENT="Igor Sfiligoi">
	<META NAME="CHANGED" CONTENT="20080909;13502500">
	<META NAME="CHANGEDBY" CONTENT="Igor Sfiligoi">
	<META NAME="CHANGEDBY" CONTENT="Igor Sfiligoi">
	<META NAME="CHANGEDBY" CONTENT="Igor Sfiligoi">
</HEAD>
<BODY LANG="en-US" DIR="LTR">
<H1>The VO Frontend</H1>
<H2>Description</H2>
<P>The VO Frontend is, as the name suggests, the user interface of a
<A HREF="../index.html">glidein&nbsp;based WMS</A>.</P>
<H2>Index</H2>
<UL>
	<LI><A HREF="#overview">Overview</A> 
	<LI><A HREF="#implementation">Implementation</A> 
	<LI><A HREF="#management">The VO Frontend management</A> 
	<LI><A HREF="#run_daemon">Starting a VO Frontend Daemon</A> 
	<LI><P><A HREF="#ref">Reference</A> 
	</P>
</UL>
<H2><A NAME="overview"></A>Overview</H2>
<P>The main task of the VO frontend is to look for user jobs and ask
the <A HREF="../factory/index.html">Glidein Factories</A> to provide
<A HREF="../index.html#glideins">glideins</A>, if needed. See the
picture below for a general overview.<BR><IMG SRC="overview.png" NAME="graphics1" ALIGN=BOTTOM WIDTH=899 HEIGHT=431 BORDER=0><BR>The
VO frontend knows nothing about the glideins or Grid sites; the only
information in has are the attributes that the various Glidein
Factories publish. This makes the life of the&nbsp;frontend much
easier, as it only has to worry about matching user job requirements
to the factory attributes.</P>
<H2><A NAME="implementation"></A>Implementation</H2>
<P>The current implementation of the VO frontend is <A HREF="http://www.python.org/">Python</A>
based, and is very simple.<BR><BR>The code is composed of 4 logical
pieces:</P>
<UL>
	<LI>a&nbsp;class that holds the Glidein Factory Ads, 
	<LI>a&nbsp;class that holds the user jobs Ads, 
	<LI>a&nbsp;matchmaking procedure,&nbsp; 
	<LI>a procedure that advertises the requests, and 
	<LI><P>the glue that links the above together. 
	</P>
</UL>
<P><A NAME="match_expr"></A>The top two classes simply contact the
appropriate Condor Collector and store the data in memory.<BR><BR>The
matchmaking procedure loops over all the <A HREF="../index.html#factory_classads">factory
ads</A> and&nbsp;counts the number of idle user jobs that match the
attributes of that particular factory entry point. <BR><BR>The
matching expression is a <A HREF="http://www.python.org/doc/">Python
expression</A>, having as inputs 
</P>
<UL>
	<LI>an object holding the job attributes, named <FONT FACE="monospace"><B>job</B></FONT>,
	and&nbsp; 
	<LI><P>an object holding the entry point attributes, named <FONT FACE="monospace"><B>glidein</B></FONT>.
		</P>
</UL>
<P>Both objects are dictionaries, with keys being attribute names,
and values being attribute values.<BR><BR>A few examples:</P>
<DL>
	<DD><PRE>job[&quot;CDFMaxHours&quot;]&lt;glidein[&quot;attrs&quot;][&quot;WMSMaxHours&quot;]
job[&quot;HasData&quot;] or (glidein[&quot;site&quot;] in string.split(job[&quot;SitesWithRequiredData&quot;]))
(job[&quot;Arch&quot;] == glidein[&quot;Arch&quot;]) and (job[&quot;gccVersion&quot;]==glidein[&quot;attrs&quot;][&quot;gccVersion&quot;])</PRE><DD><P>
	<BR>Finally, the advertise procedure loops over the counts and
	converts them into appropriate <A HREF="../index.html#frontend_classads">Condor
	Class Ads</A>.<BR><BR>The glue code is responsible of parsing the
	input parameters, loading the configuration values and loop over the
	above steps.</P></DD></DL>
<H2>
<A NAME="management"></A>The VO Frontend management</H2>
<P>The VO Frontend configuration is composed of a single file that
needs to be passed as a parameter to the executable.<BR><BR>The
configuration file is essentially a piece of Python code that needs
to define the following objects:</P>
<UL>
	<LI><FONT FACE="monospace"><B>frontend_name</B></FONT><BR>This is
	the name of the frontend, and must be a string (like
	<FONT FACE="monospace">'cms-fe1.fnal.us'</FONT>) 
	<LI><FONT FACE="monospace"><B>factory_pool</B></FONT><BR>This is the
	name of the WMS Condor Collector, and it must be a string (like
	<FONT FACE="monospace">'cmswms1.fnal.gov'</FONT>).<BR>If you are
	using a single Collector, this can be set to None. 
	<LI><FONT FACE="monospace"><B>schedd_names</B></FONT><BR>This is the
	list of schedd names where user jobs are being queued, each name
	being a string (like
	<FONT FACE="monospace">['schedd1@cmssubmit1.fnal.gov','schedd2@cmssubmit1.fnal.gov','cmssubmit2.fnal.gov']</FONT>)
	
	<LI><FONT FACE="monospace"><B>factory_constraint</B></FONT><BR>A
	<A HREF="http://www.cs.wisc.edu/condor/manual/v6.8/condor_q.html#SECTION0010263000000000000000">Condor
	constraint</A> to be used with condor_status when looking for
	glidein factories in the WMS collector. (like
	'<FONT FACE="monospace">GLIDEIN_Expose_Grid_Env=?=&quot;True&quot;'</FONT>,
	i.e. consider only glidein factories that pass on the Grid
	environment)<BR>If you want to consider all glidein factories, this
	can be set to None. 
	<LI><FONT FACE="monospace"><B>job_constraint</B></FONT><BR>A <A HREF="http://www.cs.wisc.edu/condor/manual/v6.8/condor_q.html#SECTION0010263000000000000000">Condor
	constraint</A> to be used with condor_q when looking for user jobs.
	(like '<FONT FACE="monospace">JobUniverse=?=5'</FONT>, i.e. consider
	only Vanilla jobs)<BR>If you want to consider all user jobs, this
	can be set to None. 
	<LI><FONT FACE="monospace"><B>match_string</B></FONT><BR>This is the
	matchmaking policy the frontend will use. See the <A HREF="#match_expr">Implementation
	section</A> for more information. 
	<LI><FONT FACE="monospace"><B>max_idle_glideins_per_entry</B></FONT><BR>The
	maximum number of idle glideins that will be requested for every
	glidein factory entry.<LI>
	<FONT FACE="monospace"><B>reserve_idle_glideins_per_entry</B></FONT><BR>The
	maximum overestimate used (to account for Condor-G errors).<LI>
	<FONT FACE="monospace"><B>max_idle_vms_per_entry</B></FONT><BR>The
	maximum number of idle VMs that will be tolerated before stopping
	submitting new glideins (independently on the number of idle jobs).<LI>
	<FONT FACE="monospace"><B>curb_idle_vms_per_entry</B></FONT><BR>The
	number of idle VMs needed to start reducing the number of requested
	glideins.<LI>
	<FONT FACE="monospace"><B>max_running_jobs</B></FONT><BR>When this
	number is reached, no more idle jobs will be requested. 
	<LI><FONT FACE="monospace"><B>glidein_params</B></FONT><BR>This is
	the dictionary of parameters to set in the frontend requests. In
	this version it is not flexible and will send the same parameters
	for all the requests.<BR>One parameter is always needed:
	<FONT FACE="monospace"><B>GLIDEIN_Collector</B></FONT>, and it is
	used to specify the location of the VO/glidein/user Collector (or of
	the <A HREF="../factory/entry.html#multicol">slave collectors</A>).<BR>(An
	example: <FONT FACE="monospace">glidein_params={&quot;GLIDEIN_Collector&quot;:&quot;cms-fe1.fnal.gov&quot;}</FONT>)
	
	<LI><FONT FACE="monospace"><B>log_dir</B></FONT><BR>Where to put the
	Frontend log files.<BR>(An example:
	<FONT FACE="monospace">log_dir='/tmp/glideFrontendLogs_%s'%frontend_name</FONT>)
	
	<LI><P><FONT FACE="monospace"><B>loop_delay</B></FONT><BR>This
	specifies how much time (in seconds) should pass between polling
	loops.<BR>(An example: <FONT FACE="monospace">loop_delay=60</FONT>) 
	</P>
</UL>
<H2><A NAME="run_daemon"></A>Starting a VO Frontent Daemon</H2>
<P>Once you have the desired configuration file, move to the VO
frontend directory&nbsp; and launch the command:</P>
<DL>
	<DD><PRE>./frontend_startup start</PRE><DD>
	<BR>
	</DD><DD>
	All the activity messages will go into</DD><DD>
	<FONT FACE="monospace">&lt;log_dir&gt;/frontend_info.&lt;date&gt;.log</FONT></DD><DT>
	while the warnings go into</DT><DD><P>
	<FONT FACE="monospace">&lt;log_dir&gt;/frontend_err.&lt;date&gt;.log</FONT></P></DD></DL>
<P>
<A NAME="ref"></A>The fronted logs are deleted after a week.<BR><BR><BR><BR>
</P>
<TABLE WIDTH=100% BORDER=0 CELLPADDING=2 CELLSPACING=2>
	<TR VALIGN=TOP>
		<TD>
			<H2 ALIGN=LEFT>Repository</H2>
			<H3 ALIGN=LEFT>CVSROOT</H3>
			<P ALIGN=LEFT>cvsuser@cdcvs.fnal.gov:/cvs/cd</P>
			<H2 ALIGN=LEFT>Package(s)</H2>
			<P ALIGN=LEFT>glideinWMS/frontend</TD>
		<TD>
			<H2 ALIGN=LEFT>Author(s)</H2>
			<P ALIGN=LEFT>Since Aug. 14th - Igor Sfiligoi (Fermilab Computing
			Division)</TD>
	</TR>
</TABLE>
<P><BR><BR>
</P>
</BODY>
</HTML>