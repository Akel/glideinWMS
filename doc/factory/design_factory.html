<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
  <meta http-equiv="CONTENT-TYPE" content="text/html; charset=UTF-8">
  <title>glideinWMS - Factory</title>
  <meta name="CREATED" content="0;0">
  <meta name="CHANGED" content="20100521;20081031;14115200">    
  <link rel="stylesheet" type="text/css" href="../common/glideinWMS.css" media="screen, projection" />
</head>

<body lang="en-US" dir="ltr">
    <h1>
        <a href="index.html">GlideinWMS</a>
	<span>The Glidein-based Workflow Management System</span>
    </h1>
    <ul class="breadcrumbs">
	    <li> <a href="../index.html">Home</a></li>
	    <li> <a href="./index.html">WMS Factory</a></li>
	    <li> <a href="./design.html">Design</a></li>
        <li>Factory Internals</li>
    </ul>
    <div class="clear" />
    <div class="leftmenu">
        <ul class="components">
	        <li> <a href="../index.html">Home</a></li>
	        <li> <a href="../download.html">Download</a></li>
	        <li> <a href="../frontend/index.html">Glidein Frontend</a></li>
            <li> <a href="../corral.html">Corral Frontend</a></li>
	        <li> <a href="../factory/index.html">WMS Factory</a></li>
	        <li> <a href="../components/index.html" >Components</a></li>
	        <li> <a href="../common/faq.html" class="last">FAQ</a></li>
        </ul>
        <div class="search">
            <div id="cse-search-form" style="width: 100%;">Loading</div>
            <script src="http://www.google.com/jsapi" type="text/javascript"></script>
            <script src="../common/glidein.js" type="text/javascript"></script>
            <script type="text/javascript">
            google.load('search', '1', {language : 'en', style : google.loader.themes.MINIMALIST});
            google.setOnLoadCallback(onLoad);
            </script>
        </div>
    </div>
    <div id="searchcontent"><h2>Search Results</h2><div id="cse"></div> </div>
<div class="content">
    <div class="heading">
    <img align="right" width="280px" border="0px"
        src="../images/simple_diagram.png" usemap="#rightimage">
    <map name="rightimage">
        <area shape="rect" coords="90,3,177,60" href="../frontend/index.html" />
        <area shape="rect" coords="5,88,118,146" href="../components/collector_install.html" />
        <area shape="rect" coords="134,88,275,146" href="../factory/index.html" />
        <area shape="rect" coords="189,3,274,60" target="_blank" href="../corral.html" />
    </map>

    <h2>WMS Factory Design</h2>
	<ul class="subcomponents">
	     <li> <a href="./index.html">Overview</a></li>
         <li> <a href="./install.html">Install</a></li>
	     <li> <a href="./configuration.html">Configuration</a></li>
	     <li> Design</li>
	     <li> <a href="./monitoring.html">Monitoring</a></li>
	     <li class="last"> <a href="./troubleshooting.html">Troubleshooting</a></li>
	</ul>
        <h3>Factory Internals</h3>
	</div>
<div class="jump">
<u>Jump to:</u>
<ol>
    <LI><A HREF="#overview">Overview</A></li>
    <LI><A HREF="#flow">Program flow</A></li>
    <LI><A HREF="#source">Source code distribution</A></li>
    <LI><A HREF="#config">Configuration files</A></li>
    <LI><A HREF="#encryption">Encryption</A></li>
</ol>
</div>
<div class="related">
Factory Design Topics: <br/>
<ul>
<li> Factory Internals</li>
<li> <a href="design_entry.html">Entry Internals</a></li>
<li> <a href="design_glidein.html">Glidein Internals</a></li>
<li> <a href="design_data_exchange.html">Data Exchange</a></li>
</ul>
</div>
<div class="section">

<H2><A NAME="flow"></A>Program flow</H2>
<P>The main tasks of the Factory Daemon are the startup up the Entry
Daemons and the aggregation of statistics from the entries.<BR>See
picture below for an overview.</P>
<IMG SRC="../images/flow_factory_main.png">
<p>
    The only non trivial operation in the statistics aggregation. 
The Factory Daemon reads the XML files produced by the Factory Daemons,
aggregates them, and writes out an aggregate XML file. It also
updates the <A HREF="http://oss.oetiker.ch/rrdtool/">RRD</A> files
used to keep the history and creates the rrdtool graphs and HTML
pages for human consumption.<BR>See picture below for an overview.</P>

<IMG SRC="../images/flow_factory_stats.png">
</div>

<div class="section">
<H2><A NAME="source"></A>Source code distribution</H2>
<P>The Factory Daemon is implemented as a series of python scripts,
and it does not need to be pre-compiled.</P>
<P>The code is spread over several python modules, some specific to
the factory other shared between different parts of the glideinWMS.
There are also an external dependency on the <A HREF="http://oss.oetiker.ch/rrdtool/">rrdtool</A>
python libraries.
</p>
<p>The picture below shows the dependency tree.</P>
<P><IMG SRC="../images/modules_factory.png">
</p><p>glideFactory.py
is executable.</P>

<P>The glideinWMS common libraries are in glideinWMS/lib directory.</P>
</div>

<div class="section">
<H2><A NAME="config"></A>Configuration files</H2>
<P>The Factory daemon reads a single configuration file:</p>
    <TT>glidein.descript</TT>
<p>It is located in the root of the factory configuration tree.</P>
<P>Only two elements of this configuration file are used:</P>
<UL>

    <LI><TT>Entries</TT> - The list of entries, used to launch the Entry Daemons.</li>
    <LI><TT>LoopDelay</TT> - How long should it sleep between iterations.</li>
</UL>
<P><B>Warning</B>: The configuration file should never be changed by
hand. It is generated and maintained by 
<A HREF="index.html#create_entry">a dedicated tool.</A></P>
</div>
<div class="section">
<h2><a name="encryption" />Encryption Overview</h2>
<p>
The glidenWMS Factory creates an RSA public/private keypair.  The public
key is advertised so that the Frontend can use it.
</p>
<p>
When the Frontend advertises requests and credentials, it performs the
following steps:
<ol>
    <li> Create a symmetric key for each classad</li>
    <li> Encrypt all applicable information using the symmetric key</li>
    <li> Encrypt the symmetric key with the Factory public key</li>
    <li> Advertise the classad</li>
</ol>
The Factory performs the following steps to decrypt the Frontend values:
<ol>
    <li>Extract the Frontend symmetric key by decrypting it using the Factory
       private key</li>
    <li> Use the Frontend symmetric key to decrypt all remaining encrypted
       parameters</li>
</ol>
Specific code modules that handle these functions can be found below.
</p>
<p>
glideFactory.main()
<ul>
    <li> Creates glideFactoryConfig.GlideinKey with <i>recreate == True</i></li>
    <li> glideFactoryConfig.GlideinKey creates a new RSA private/public
      keypair</li>
    <li> It is assumed that the Frontend symmetric key can be loaded using the
      symCrypto.AutoSymKey class</li>
</ul>
glideFactoryInterface.findwork and the glideFactoryCredentials module share
similar logic for decrypting classads:
<ul>
    <li> Get classads</li>
    <li> For each classad:</li>
    <ul>
        <li> Extract the Frontend symmetric key using the Factory private key</li>
        <li> Use the symmetric key to decrypt the 'ReqEncIdentity' field</li>
        <li> Compare 'ReqEncIdentity' to 'AuthenticatedIdentity'</li>
        <ul>
            <li> 'AuthenticatedIdentity' is the identity that Condor places
                in the classad.</li>
            <li> The two must match to prove that someone isn't spoofing the
              classad</li>
        </ul>
        <li> Compare 'ReqEncIdentity' to the expected identity listed in the
          frontend.descript (to check that the Frontend advertising is
          authorized by the Factory)</li>
        <li> Loop through the encrypted parameters and decrypt them</li>
    </ul>
</ul>


</div>
<div class="footer">
Banner image by
<a href="http://www.flickr.com/people/leafwarbler/">Madhusudan Katti</a>
used under Creative Commons license.<br/>
Original Home URL: <a href="http://www.uscms.org/SoftwareComputing/Grid/WMS/glid
einWMS">http://www.uscms.org/SoftwareComputing/Grid/WMS/glideinWMS</a>.
glideinWMS email support: glideinwms-support at fnal.gov
</div>


</div>
</body>
</html>
